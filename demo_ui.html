<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CaseMind ‚Äì Legal Case Analysis</title>
<style>
    body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; min-height: 100vh; }
    header { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); color: white; padding: 20px 32px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h1 { margin: 0; font-size: 28px; font-weight: 600; letter-spacing: 0.5px; }
    
    .container { 
        display: flex; 
        max-width: 100%; 
        margin: 0;
        gap: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        padding: 0;
        width: 100%;
    }

    /* Floating History Button */
    #floatingHistoryBtn {
        position: fixed;
        bottom: 32px;
        left: 32px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(30, 64, 175, 0.4);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    #floatingHistoryBtn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(30, 64, 175, 0.5);
    }
    
    #floatingHistoryBtn:active {
        transform: scale(0.95);
    }

    /* History Drawer */
    #historyDrawer {
        position: fixed;
        left: 0;
        top: 0;
        width: 320px;
        height: 100vh;
        background: white;
        padding: 0;
        overflow: hidden;
        box-shadow: 2px 0 16px rgba(0,0,0,0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform: translateX(-100%);
        z-index: 999;
    }
    
    #historyDrawer.open { 
        transform: translateX(0);
    }
    
    #historyDrawer .drawer-header {
        background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
        color: white;
        padding: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    #historyDrawer .drawer-header h3 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
    }
    
    #historyDrawer .drawer-content {
        padding: 20px;
    }
    
    .close-drawer {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s ease;
    }
    
    .close-drawer:hover {
        background: rgba(255, 255, 255, 0.3);
    }
    
    #historyList {
        max-height: calc(100vh - 240px);
        overflow-y: auto;
        margin-bottom: 16px;
    }
    
    #historyList::-webkit-scrollbar {
        width: 6px;
    }
    
    #historyList::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    
    #historyList::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    #historyList::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
    
    .history-item { 
        padding: 14px; 
        border-radius: 8px; 
        margin-bottom: 12px; 
        cursor: pointer;
        background: #f8fafc;
        border-left: 3px solid transparent;
        transition: all 0.2s ease;
    }
    .history-item:hover { 
        background: #eff6ff; 
        border-left-color: #1e40af;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    /* Main Panel */
    .main { 
        flex: 1; 
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 0;
    }
    
    /* Split Panel Layout */
    .split-container {
        display: flex;
        gap: 0;
        height: calc(100vh - 88px);
        position: relative;
        width: 100%;
    }
    
    .left-panel {
        width: 40%;
        background: #1e1e1e;
        border-right: 1px solid #e2e8f0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: sticky;
        top: 0;
        height: calc(100vh - 88px);
    }
    
    .right-panel {
        width: 60%;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 32px 48px;
        background: #f8fafc;
    }
    
    .right-panel::-webkit-scrollbar {
        width: 8px;
    }
    
    .right-panel::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
    }
    
    .right-panel::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }
    
    .right-panel::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
    
    .pdf-viewer-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #1e1e1e;
        padding: 40px;
        overflow: auto;
    }
    
    .pdf-viewer-container::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }
    
    .pdf-viewer-container::-webkit-scrollbar-track {
        background: #2b2b2b;
    }
    
    .pdf-viewer-container::-webkit-scrollbar-thumb {
        background: #4a4a4a;
        border-radius: 5px;
    }
    
    .pdf-viewer-container::-webkit-scrollbar-thumb:hover {
        background: #5a5a5a;
    }
    
    .pdf-viewer {
        width: 100%;
        height: 100%;
        border: none;
        background: white;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        border-radius: 4px;
    }
    
    .card { 
        background: white; 
        padding: 28px 32px; 
        border-radius: 12px; 
        box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        margin-bottom: 0;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }
    
    .card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    
    /* Actions Section */
    .actions-section {
        background: white;
        padding: 28px 32px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
    }
    
    .actions-section h3 {
        margin: 0 0 24px 0;
        color: #1e293b;
        font-size: 20px;
        font-weight: 600;
    }
    
    .actions-grid {
        display: flex;
        gap: 16px;
        flex-wrap: nowrap;
        overflow-x: auto;
    }
    
    .actions-grid::-webkit-scrollbar {
        height: 6px;
    }
    
    .actions-grid::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    
    .actions-grid::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    .actions-grid::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
    
    .btn-action { 
        flex: 0 0 auto;
        min-width: 220px;
        max-width: 280px;
        text-align: left; 
        padding: 24px; 
        border-radius: 12px; 
        background: white; 
        margin-bottom: 0;
        border: 1px solid #e2e8f0;
        font-weight: 500;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        font-size: 15px;
        color: #1e293b;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        transition: all 0.2s ease;
    }
    
    .btn-action .action-icon {
        font-size: 32px;
        line-height: 1;
        width: 56px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        background: #f8fafc;
    }
    
    .btn-action:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
        border-color: #cbd5e1;
    }
    
    .btn-action.active { 
        background: #1e40af; 
        color: white;
        border-color: #1e40af;
        box-shadow: 0 6px 20px rgba(30, 64, 175, 0.3);
    }
    
    .btn-action.active .action-icon {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }
    
    .btn-action .action-label {
        font-size: 15px;
        font-weight: 600;
    }
    
    .btn-action .action-description {
        font-size: 13px;
        color: #64748b;
        font-weight: 400;
    }
    
    .btn-action.active .action-description {
        color: rgba(255, 255, 255, 0.8);
    }

    /* Buttons */
    button { 
        cursor: pointer; 
        border: none; 
        border-radius: 8px; 
        padding: 12px 20px; 
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    .btn-primary { 
        background: #1e40af; 
        color: white; 
    }
    
    .btn-primary:hover {
        background: #1e3a8a;
    }
    
    .btn-secondary { 
        background: #f1f5f9; 
        color: #475569;
    }
    
    .btn-secondary:hover {
        background: #e2e8f0;
    }
    
    .btn-new-search {
        background: #059669;
        color: white;
        position: fixed;
        top: 24px;
        right: 32px;
        z-index: 100;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-new-search:hover {
        background: #047857;
    }
    
    .btn-danger { 
        background: #dc2626; 
        color: white; 
        width: 100%;
    }
    
    .btn-danger:hover {
        background: #b91c1c;
    }
    
    .btn-action:hover {
        background: #e0e7ff;
        border-color: #c7d2fe;
    }
    
    .btn-action.active { 
        background: #1e40af; 
        color: white;
        border-color: #1e40af;
    }

    /* Similar Case Card */
    .case-card { 
        background: white; 
        border-radius: 10px; 
        box-shadow: 0 1px 3px rgba(0,0,0,0.08); 
        margin-bottom: 16px;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .case-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-color: #1e40af;
    }
    
    .case-header {
        padding: 20px;
        cursor: pointer;
        transition: background 0.2s ease;
    }
    
    .case-header:hover {
        background: #f8fafc;
    }
    
    .case-title-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .case-title {
        flex: 1;
        margin-right: 16px;
    }
    
    .case-title h4 {
        margin: 0 0 6px 0;
        color: #1e293b;
        font-size: 16px;
        font-weight: 600;
    }
    
    .case-title .case-meta {
        font-size: 13px;
        color: #64748b;
    }
    
    .case-similarity {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .similarity-badge {
        background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 14px;
    }
    
    .expand-button {
        text-align: center;
        color: #1e40af;
        font-size: 13px;
        font-weight: 600;
        padding: 8px 0;
        border-top: 1px solid #e2e8f0;
        margin-top: 12px;
    }
    
    .expand-hint {
        display: none;
    }
    
    .expand-icon {
        display: none;
    }
    
    .case-card.expanded .expand-hint {
        display: none;
    }
    
    .case-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-top: 1px solid #e2e8f0;
    }
    
    .case-card.expanded .case-details {
        max-height: 1000px;
    }
    
    .case-details-content {
        padding: 20px;
    }
    
    .detail-section {
        margin-bottom: 16px;
    }
    
    .detail-section:last-child {
        margin-bottom: 0;
    }
    
    .detail-label {
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }
    
    .detail-value {
        color: #334155;
        line-height: 1.6;
    }
    
    .ipc-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .ipc-tag {
        background: #eff6ff;
        color: #1e40af;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        border: 1px solid #dbeafe;
    }
    
    .hidden {
        display: none !important;
    }
    
    .badge { 
        padding: 8px 14px; 
        border-radius: 6px; 
        font-size: 12px; 
        color: white;
        font-weight: 600;
        display: inline-block;
        background: #1e40af;
    }
    
    /* Overlay for drawer */
    #drawerOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 998;
    }
    
    #drawerOverlay.active {
        opacity: 1;
        visibility: visible;
    }
</style>
</head>

<body>

<header>
    <div style="text-align: center;">
        <h1>‚öñÔ∏è CaseMind</h1>
        <div style="font-size: 14px; opacity: 0.9; margin-top: 4px;">Legal Case Analysis System</div>
    </div>
</header>

<!-- New Search Button -->
<button id="newSearchBtn" class="btn-new-search" onclick="newSearch()" style="display:none;">
    <span>üîç</span>
    <span>New Search</span>
</button>

<!-- Floating History Button -->
<button id="floatingHistoryBtn" onclick="toggleHistory()">
    <span id="historyIcon">üìú</span>
</button>

<!-- Drawer Overlay -->
<div id="drawerOverlay" onclick="toggleHistory()"></div>

<!-- HISTORY DRAWER -->
<div id="historyDrawer">
    <div class="drawer-header">
        <h3>üìú Search History</h3>
        <button class="close-drawer" onclick="toggleHistory()">‚úï</button>
    </div>
    <div class="drawer-content">
        <div id="historyList"></div>
        <button class="btn-danger" onclick="clearHistory()">Clear History</button>
    </div>
</div>

<div class="container">

    <!-- MAIN CONTENT -->
    <div class="main">

        <!-- STEP 1: SEARCH / UPLOAD -->
        <div id="step1" class="card">
            <h2 style="color: #1e293b; margin-top: 0;">Find Similar Legal Cases</h2>
            <p style="color: #64748b;">Upload a PDF or describe the case to get started.</p>

            <!-- Tabs -->
            <div style="display:flex; gap:12px; margin: 20px 0;">
                <button onclick="switchTab('text')" id="tabText" class="btn-primary">üí¨ Text Search</button>
                <button onclick="switchTab('upload')" id="tabUpload" class="btn-secondary">üìÑ Upload PDF</button>
            </div>

            <!-- TEXT SEARCH -->
            <div id="textSearchBox">
                <textarea id="textQuery" placeholder="Describe your case here..." style="width:100%; height:140px; padding:14px; border-radius:10px; border: 2px solid #e2e8f0; font-family: inherit; font-size: 14px; transition: all 0.2s ease;"></textarea>
                <br><br>
                <button class="btn-primary" onclick="runTextSearch()">üîç Analyze Case</button>
            </div>

            <!-- FILE UPLOAD -->
            <div id="fileBox" style="display:none; border:2px dashed #94a3b8; padding:50px; text-align:center; border-radius:12px; background: #f8fafc; transition: all 0.3s ease;">
                <p style="font-size: 16px; color: #475569; margin-bottom: 16px;">üìÑ Drop your PDF here or click to upload</p>
                <input id="fileInput" type="file" accept="application/pdf" onchange="uploadFile(event)" style="max-width: 300px;">
            </div>
        </div>

        <!-- STEP 2: ANALYSIS + RESULTS -->
        <div id="step2" style="display:none;">
            <div id="normalLayout" style="padding: 32px 48px;">
                <!-- Document Summary -->
                <div class="card" id="docSummary"></div>

                <!-- Action Buttons -->
                <div class="card" id="actionButtons"></div>

                <!-- Results (hidden until action is chosen) -->
                <div id="results" class="card hidden"></div>
            </div>
            
            <div id="splitLayout" style="display:none;">
                <div class="split-container">
                    <div class="left-panel">
                        <div class="pdf-viewer-container">
                            <iframe id="pdfViewer" class="pdf-viewer"></iframe>
                        </div>
                    </div>
                    <div class="right-panel">
                        <!-- Document Summary -->
                        <div class="card" id="docSummarySplit"></div>

                        <!-- Action Buttons -->
                        <div class="card" id="actionButtonsSplit"></div>

                        <!-- Results (hidden until action is chosen) -->
                        <div id="resultsSplit" class="card hidden"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
/* ------------------------------
   UTILITIES
------------------------------ */

let historyData = JSON.parse(localStorage.getItem("cm_history") || "[]");
let currentCategory = "";
let selectedAction = "";
let currentQueryOrFile = "";

/* -----------------------------------
   HISTORY DRAWER
----------------------------------- */

function toggleHistory() {
    const drawer = document.getElementById("historyDrawer");
    const overlay = document.getElementById("drawerOverlay");
    const icon = document.getElementById("historyIcon");
    const isOpen = drawer.classList.toggle("open");
    
    overlay.classList.toggle("active", isOpen);
    
    // Update floating button icon
    icon.textContent = isOpen ? "‚úï" : "üìú";
}

function saveHistory(item) {
    historyData.unshift(item);
    localStorage.setItem("cm_history", JSON.stringify(historyData));
    renderHistory();
}

function clearHistory() {
    localStorage.removeItem("cm_history");
    historyData = [];
    renderHistory();
}

function renderHistory() {
    const list = document.getElementById("historyList");
    list.innerHTML = historyData.map(item => `
        <div class="history-item" onclick='loadHistory(${JSON.stringify(item)})'>
            <strong>${item.query}</strong><br>
            <span style="font-size:12px; color:#64748b;">${item.category} ‚Ä¢ ${item.date}</span>
        </div>
    `).join("");
}

function loadHistory(item) {
    document.getElementById("step1").style.display = "none";
    document.getElementById("step2").style.display = "block";
    currentCategory = item.category;
    currentQueryOrFile = item.query;
    showAnalysisCard();
    renderActions(item.category);
}

/* -----------------------------------
   SWITCH TABS
----------------------------------- */

function switchTab(tab) {
    const textBox = document.getElementById("textSearchBox");
    const fileBox = document.getElementById("fileBox");
    const tabText = document.getElementById("tabText");
    const tabUpload = document.getElementById("tabUpload");
    
    if (tab === "text") {
        textBox.style.display = "block";
        fileBox.style.display = "none";
        tabText.className = "btn-primary";
        tabUpload.className = "btn-secondary";
    } else {
        textBox.style.display = "none";
        fileBox.style.display = "block";
        tabUpload.className = "btn-primary";
        tabText.className = "btn-secondary";
    }
}

/* -----------------------------------
   TEXT SEARCH
----------------------------------- */

function runTextSearch() {
    const query = document.getElementById("textQuery").value.trim();
    if (!query) return alert("Please enter text.");

    currentQueryOrFile = query;
    currentCategory = "Text Query";

    saveHistory({ query, category: "Text Query", date: new Date().toISOString().split("T")[0] });

    document.getElementById("step1").style.display = "none";
    document.getElementById("step2").style.display = "block";
    document.getElementById("normalLayout").style.display = "block";
    document.getElementById("splitLayout").style.display = "none";
    document.getElementById("newSearchBtn").style.display = "flex";

    showAnalysisCard(false);
    renderActions("Text Query", "actionButtons");
}

/* -----------------------------------
   FILE UPLOAD
----------------------------------- */

function uploadFile(event) {
    const file = event.target.files[0];
    if (!file) return;

    currentQueryOrFile = file.name;

    const categories = ["FIR", "Judgment", "Medical Evidence", "Witness Statement"];
    currentCategory = categories[Math.floor(Math.random() * categories.length)];

    saveHistory({ query: file.name, category: currentCategory, date: new Date().toISOString().split("T")[0] });

    document.getElementById("step1").style.display = "none";
    document.getElementById("step2").style.display = "block";
    document.getElementById("normalLayout").style.display = "none";
    document.getElementById("splitLayout").style.display = "block";
    document.getElementById("newSearchBtn").style.display = "flex";

    // Load PDF in viewer
    const fileURL = URL.createObjectURL(file);
    document.getElementById("pdfViewer").src = fileURL;

    showAnalysisCard(true);
    renderActions(currentCategory, "actionButtonsSplit");
}

/* -----------------------------------
   DOCUMENT ANALYSIS CARD
----------------------------------- */

function showAnalysisCard(isSplit = false) {
    const content = `
        <h3 style="margin-top: 0;">üìÑ Document Analysis</h3>
        <p><strong>Input:</strong> ${currentQueryOrFile}</p>
        <p><strong>Category:</strong> ${currentCategory}</p>

        <div style="display:flex; gap:20px; margin-top:12px; flex-wrap: wrap;">
            <div><strong>Entities:</strong> 12</div>
            <div><strong>IPC Sections:</strong> 3</div>
            <div><strong>Confidence:</strong> 95%</div>
        </div>
    `;
    
    if (isSplit) {
        document.getElementById("docSummarySplit").innerHTML = content;
    } else {
        document.getElementById("docSummary").innerHTML = content;
    }
}

/* -----------------------------------
   ACTION BUTTONS
----------------------------------- */

const categoryActions = {
    "FIR": ["explain", "similar", "bail", "ipc"],
    "Judgment": ["explain", "similar", "precedent", "summary"],
    "Medical Evidence": ["explain", "similar", "evidence"],
    "Witness Statement": ["explain", "similar", "evidence"],
    "Text Query": ["explain", "similar", "ipc"]
};

function renderActions(category, targetId = "actionButtons") {
    const actions = categoryActions[category];
    let html = `<div class="actions-section"><h3>Choose an action</h3><div class="actions-grid">`;

    actions.forEach(a => {
        const actionInfo = getActionInfo(a);
        html += `
            <button class="btn-action" id="btn-${a}" onclick="selectAction('${a}')">
                <span class="action-icon">${actionInfo.icon}</span>
                <div>
                    <div class="action-label">${actionInfo.label}</div>
                    <div class="action-description">${actionInfo.description}</div>
                </div>
            </button>
        `;
    });
    
    html += `</div></div>`;

    document.getElementById(targetId).innerHTML = html;
}

function getActionInfo(action) {
    const actionMap = {
        explain: { icon: 'üìñ', label: 'Explain Case', description: 'Get detailed case explanation' },
        similar: { icon: 'üîç', label: 'Find Similar Cases', description: 'Search similar judgments' },
        bail: { icon: 'üõ°Ô∏è', label: 'Bail Strategy', description: 'Analyze bail possibilities' },
        ipc: { icon: '‚öñÔ∏è', label: 'IPC Analysis', description: 'Analyze applicable sections' },
        precedent: { icon: 'üìö', label: 'Legal Precedent', description: 'Find relevant precedents' },
        summary: { icon: 'üìù', label: 'Case Summary', description: 'Generate executive summary' },
        evidence: { icon: 'üî¨', label: 'Evidence Analysis', description: 'Evaluate evidence strength' }
    };
    return actionMap[action] || { icon: '‚Ä¢', label: action, description: '' };
}

function renderActions(category, targetId = "actionButtons") {
    const actions = categoryActions[category];
    let html = `<div class="actions-section"><h3>Choose an action</h3><div class="actions-grid">`;

    actions.forEach(a => {
        const actionInfo = getActionInfo(a);
        html += `
            <button class="btn-action" id="btn-${a}" onclick="selectAction('${a}')">
                <span class="action-icon">${actionInfo.icon}</span>
                <div>
                    <div class="action-label">${actionInfo.label}</div>
                    <div class="action-description">${actionInfo.description}</div>
                </div>
            </button>
        `;
    });
    
    html += `</div></div>`;

    document.getElementById(targetId).innerHTML = html;
}

function getActionInfo(action) {
    const actionMap = {
        explain: { icon: 'üìñ', label: 'Explain Case', description: 'Get detailed case explanation' },
        similar: { icon: 'üîç', label: 'Find Similar Cases', description: 'Search similar judgments' },
        bail: { icon: 'üõ°Ô∏è', label: 'Bail Strategy', description: 'Analyze bail possibilities' },
        ipc: { icon: '‚öñÔ∏è', label: 'IPC Analysis', description: 'Analyze applicable sections' },
        precedent: { icon: 'üìö', label: 'Legal Precedent', description: 'Find relevant precedents' },
        summary: { icon: 'üìù', label: 'Case Summary', description: 'Generate executive summary' },
        evidence: { icon: 'üî¨', label: 'Evidence Analysis', description: 'Evaluate evidence strength' }
    };
    return actionMap[action] || { icon: '‚Ä¢', label: action, description: '' };
}

/* -----------------------------------
   ACTION RESULT RENDERING
----------------------------------- */

function selectAction(action) {
    selectedAction = action;

    document.querySelectorAll(".btn-action").forEach(btn => btn.classList.remove("active"));
    document.getElementById("btn-" + action).classList.add("active");

    const isSplit = document.getElementById("splitLayout").style.display === "block";
    const targetId = isSplit ? "resultsSplit" : "results";
    
    // Show results section
    document.getElementById(targetId).classList.remove("hidden");
    
    renderResults(action, isSplit);
    
    // Scroll to results if in split view
    if (isSplit) {
        document.getElementById(targetId).scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
}

function renderResults(action, isSplit = false) {
    const targetId = isSplit ? "resultsSplit" : "results";
    const target = document.getElementById(targetId);
    
    if (action === "explain") {
        target.innerHTML = `
            <h3 style="margin-top: 0;">üìò Case Explanation</h3>
            <p>(Dummy) This case involves allegations with extracted entities, timeline inconsistencies, and witness contradictions.</p>
        `;
    }

    if (action === "bail") {
        target.innerHTML = `
            <h3 style="margin-top: 0;">üõ°Ô∏è Bail Strategy</h3>
            <ul>
                <li>Assess severity of IPC sections</li>
                <li>Highlight mitigating factors</li>
                <li>Propose conditional bail terms</li>
            </ul>
        `;
    }

    if (action === "ipc") {
        target.innerHTML = `
            <h3 style="margin-top: 0;">‚öñÔ∏è IPC Analysis</h3>
            <p>302 ‚Äì Murder (Life imprisonment)</p>
            <p>201 ‚Äì Destruction of evidence</p>
            <p>34 ‚Äì Common intention</p>
        `;
    }

    if (action === "precedent") {
        target.innerHTML = `
            <h3 style="margin-top: 0;">üìö Legal Precedents</h3>
            <p>ABC vs State (2015) ‚Äì Circumstantial evidence</p>
            <p>XYZ vs Union (2019) ‚Äì Bail guidelines</p>
        `;
    }

    if (action === "evidence") {
        target.innerHTML = `
            <h3 style="margin-top: 0;">üîç Evidence Strength</h3>
            <p>Post-mortem: Strong</p>
            <p>Witness statements: Moderate inconsistency</p>
        `;
    }

    if (action === "summary") {
        target.innerHTML = `
            <h3 style="margin-top: 0;">üìù Executive Summary</h3>
            <p>(Dummy) Case involves major allegations with forensic dependencies.</p>
        `;
    }

    if (action === "similar") renderSimilarCases(isSplit);
}

/* -----------------------------------
   SIMILAR CASES
----------------------------------- */

function renderSimilarCases(isSplit = false) {
    const targetId = isSplit ? "resultsSplit" : "results";
    const cases = [
        { 
            name: "State vs Rajesh Kumar", 
            sim: 94, 
            court: "Bombay High Court", 
            year: "2022",
            ipc: ["302", "34"],
            judge: "Justice A.K. Sharma",
            facts: "Case involving allegations of murder with common intention. The prosecution presented circumstantial evidence including witness testimonies and forensic reports.",
            outcome: "Convicted under IPC 302 and 34. Sentenced to life imprisonment."
        },
        { 
            name: "Ramesh vs State of UP", 
            sim: 89, 
            court: "Allahabad High Court", 
            year: "2021",
            ipc: ["302", "120B"],
            judge: "Justice R.K. Verma",
            facts: "Criminal conspiracy leading to murder. Evidence included phone records, witness statements, and recovery of weapon.",
            outcome: "Convicted under IPC 302 and 120B. Life imprisonment awarded."
        },
        { 
            name: "State vs Prakash Mehta", 
            sim: 85, 
            court: "Delhi High Court", 
            year: "2023",
            ipc: ["302", "201"],
            judge: "Justice S.N. Patel",
            facts: "Murder case with destruction of evidence. Prosecution relied on DNA evidence and CCTV footage.",
            outcome: "Convicted under IPC 302 and 201. Sentenced to life imprisonment with fine."
        }
    ];

    let html = `<h3 style="color: #1e293b; margin-top: 0; margin-bottom: 20px;">üîé Similar Cases (${cases.length} matches)</h3>`;

    cases.forEach((c, index) => {
        html += `
            <div class="case-card" id="case-${index}">
                <div class="case-header" onclick="toggleCase(${index})">
                    <div class="case-title-row">
                        <div class="case-title">
                            <h4>${c.name}</h4>
                            <div class="case-meta">${c.court} ‚Ä¢ ${c.year}</div>
                        </div>
                        <span class="similarity-badge">${c.sim}% Match</span>
                    </div>
                    <div class="expand-button" id="expand-btn-${index}">Show details</div>
                </div>
                <div class="case-details">
                    <div class="case-details-content">
                        <div class="detail-section">
                            <div class="detail-label">Court & Judge</div>
                            <div class="detail-value">${c.court} | ${c.judge}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">IPC Sections</div>
                            <div class="ipc-tags">
                                ${c.ipc.map(section => `<span class="ipc-tag">IPC ${section}</span>`).join('')}
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">Case Facts</div>
                            <div class="detail-value">${c.facts}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">Judgment Outcome</div>
                            <div class="detail-value">${c.outcome}</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });

    document.getElementById(targetId).innerHTML = html;
}

function newSearch() {
    document.getElementById("step1").style.display = "block";
    document.getElementById("step2").style.display = "none";
    document.getElementById("newSearchBtn").style.display = "none";
    document.getElementById("textQuery").value = "";
    document.getElementById("fileInput").value = "";
    
    // Hide results sections
    document.getElementById("results").classList.add("hidden");
    document.getElementById("resultsSplit").classList.add("hidden");
    
    switchTab("text");
}

function toggleCase(index) {
    const card = document.getElementById(`case-${index}`);
    const btn = document.getElementById(`expand-btn-${index}`);
    const isExpanded = card.classList.toggle('expanded');
    btn.textContent = isExpanded ? 'Hide details' : 'Show details';
}

/* -----------------------------------
   HELPERS
----------------------------------- */

function formatActionLabel(a) {
    return {
        explain: "üìò Explain Case",
        similar: "üîé Find Similar Cases",
        bail: "üõ°Ô∏è Bail Strategy",
        ipc: "‚öñÔ∏è IPC Analysis",
        precedent: "üìö Legal Precedent",
        summary: "üìù Case Summary",
        evidence: "üîç Evidence Analysis"
    }[a];
}

/* -----------------------------------
   INIT
----------------------------------- */

renderHistory();
switchTab("text");

</script>

</body>
</html>
